<style>
.bg-white {
	background: white !important;
}
.right {
	float: right !important;
}
.issue-status {
	border-radius: 5px !important; 
	padding: 5px 15px !important; 
	line-height: 40px !important;
	color: white;
	margin-right: 10px;
}
.issue-open {
	background-color: #3cbd70 !important; 
}
.issue-close {
	background-color: #c50404 !important; 
}
.issue-pending {
	background-color: #ffbe00 !important; 
}
md-select .md-select-value {
	border-bottom-color: white;
}
md-select:not([disabled]):focus .md-select-value {
	border-bottom-color: white !important;
}
md-select:not([disabled]):focus .md-select-value {
	color: white !important;
}
md-input-container {
  margin-bottom: 0px !important;
  margin-top: 18px !important;
}
md-input-container .md-input {
	border-color: white !important;
	color: white !important;
}
md-input-container.md-default-theme .md-input::-webkit-input-placeholder,
md-input-container .md-input::-webkit-input-placeholder {
  color: white !important;
}
md-input-container.md-default-theme .md-input:-moz-placeholder,
md-input-container .md-input:-moz-placeholder {
  color: white !important;
}
md-input-container.md-default-theme .md-input:-ms-input-placeholder,
md-input-container .md-input:-ms-input-placeholder {
  color: white !important;
}
md-input-container.md-default-theme .md-input::-moz-placeholder,
md-input-container .md-input::-moz-placeholder {
  color: white !important;
}
.md-datepicker-triangle-button .md-datepicker-expand-triangle {
  border-top-color: white;
}
.note-editor {
  margin-bottom: 0 !important;
}
</style>
<!-- Page Header -->
<div class="content bg-gray-lighter">
    <div class="row items-push">
        <div class="col-sm-7">
            <h1 class="page-heading">
                Issues </br>
								<small>Close, Edit, Create Issues.</small>
            </h1>
        </div>
        <div class="col-sm-5 text-right hidden-xs">
            <ol class="breadcrumb push-10-t">
                <li><a data-ui-sref="issues" class="link-effect" >Issues</a></li>
                <li>View</li>
            </ol>
        </div>
    </div>
</div>
<!-- END Page Header -->

<!-- Page Content -->
<div class="content">
    <div class="row">
        <div class="col-lg-12">
					<md-card>
						<md-card-content>
							<div style="float: left;" class="col-md-6 col-xs-12">
									<span class="issue-status issue-open" ng-if='issue.status == "open"'>OPEN</span>
									<span class="issue-status issue-pending" ng-if='issue.status == "pending"'>PENDING</span>
									<span class="issue-status issue-close" ng-if='issue.status == "close"'>CLOSE</span>
									<span><strong>Issue #{{issue.ticket_id}}</strong></span>
									<span> opened <strong>{{issue.date_opened_formatted}}</strong> ago by </span>
									<span><strong>{{issue.opened_by.full_name}}</strong></span> 
							</div>
							<div style="float: right;" class="col-md-6 col-xs-12">
									<md-button ng-if='user.role == "manager"' data-ui-sref="newissues" class="col-xs-12 col-sm-2 right md-raised md-primary">New Issue</md-button>
									<md-button ng-if='isAuthorized && user.role == "manager"' aria-label="close issue" ng-click="closeIssue(issue)" class="col-xs-12 col-sm-3 right md-raised md-primary">
										<span ng-if='issue.status == "open" || issue.status == "pending"'>Close Issue</span>
										<span ng-if="issue.status == 'close'">Open Issue</span>
									</md-button>
									<md-button ng-if='isAuthorized && user.role == "manager"' aria-label="peding issue" ng-click="setIssueToPending(issue)" class="col-xs-12 col-sm-2 right md-raised md-primary">
                    Pending
									</md-button>
									<md-button  ng-if='user.role == "manager"'data-ui-sref="editissues({id: issue._id})" class="col-xs-12 col-sm-2 right md-raised md-primary">Edit</md-button>
							</div>
							<div style="margin: 25px 0" class="col-xs-12">
							 <md-divider></md-divider>
							</div>
							<div class="col-xs-12">
								<h3 style="margin-bottom: 25px;">
                  {{issue.site.SiteCode || '__'}}/{{issue.site.DeviceId || '__'}}, {{issue.site.SiteName || '__'}} {{issue.title ? '-' : ''}} {{issue.title}}
                </h3>
								<p style="line-height: 35px;">
								{{issue.description}}
								</p>
							</div>
						</md-card-content>
					</md-card>
        <div class="col-xs-12">
            <!-- Chat Fixed Height -->
            <div class="block">
                <ul class="nav nav-tabs nav-tabs-alt" data-js-tabs>
                    <li class="active">
                        <a href="#chat-window1">
                            <img class="img-avatar img-avatar16" src="assets/img/avatars/avatar8.jpg" alt="">
                            <span class="push-5-l">Comments</span>
                        </a>
                    </li>
                </ul>
                <div class="tab-content overflow-hidden">
                    <!-- Chat Window 5 -->
                    <div class="tab-pane fade in active" id="chat-window1">
                        <div class="js-chat-talk overflow-y-auto block-content block-content-full" data-chat-id="5">
                            <!-- Messages -->
														<div ng-repeat="comment in comments" class="row" style="margin-bottom: 30px;">
															<div class="col-sm-1 col-xs-12">
																<img class="img-avatar img-avatar-thumb" src="assets/img/avatars/avatar10.jpg" alt="">
															</div>
															<div class="col-sm-10 col-xs-12" style="/* margin-top: 10px; */">
																<md-card class="_md">
																	<md-card-content style="padding: 0;">
																		<div>
																			<div style="margin-bottom: 0;/* background-color: #5b90d2; */padding-left: 20px;padding: 15px;" class="bg-gray-lighter">
                                        <span style="/* color: white; */font-weight: bold;">{{comment.created_by.full_name}} </span>
                                        <!-- <span style="/* color: white; */font-weight: bold;">{{comment.created_by.full_name}} | {{user.full_name}} | {{user.role}}</span> -->

                                        <span style="/* color: white; */">commented {{comment.date_opened_formatted}} ago</span>

																				<span ng-if="editing[comment._id] !== true && user.full_name == comment.created_by.full_name" ng-click="edit(comment)" style="float: right; cursor: pointer; text-decoration: underline;">Edit <i class="si si-pencil"></i></span>
																				<span ng-if="editing[comment._id] == true" ng-click="save(comment)" style="float: right; cursor: pointer; text-decoration: underline;">Save</i></span>
																				<span ng-if="editing[comment._id] == true" ng-click="cancel(comment)" style="margin-right: 10px; float: right; cursor: pointer; text-decoration: underline;">Cancel </i></span>
																			</div>
																		</div>
																		<div ng-attr-id="{{'click2edit_' + comment._id}}" style="min-height: 64px;padding-left: 15px;padding-top: 15px;">
																			<p ng-bind-html="comment.message"></p>
																		</div>
                                    <md-toolbar ng-if="editing[comment._id] == true" class="md-theme-light" style="justify-content: center">
                                      <div class="col-xs-12" layout-gt-xs="row">
                                        <md-input-container style="font-size: 15px; margin-bottom: 30px !important; margin-right: 30px !important;">
                                          <label style="color: white">Assignee</label>
                                          <md-select style="min-width: 200px;" ng-model="issue.assignee" ng-model-options="{trackBy: '$value._id'}" ng-change="selectFilter()" flex-gt-sm>
                                            <md-option ng-value="none"><em>None</em></md-option>
                                            <md-option ng-repeat="assignee in assignees | orderBy: 'full_name'" ng-value="assignee">
                                              {{assignee.full_name}}
                                            </md-option>
                                          </md-select>
                                        </md-input-container>
                                        <md-input-container>
                                          <label style="left: 0; color: white">Due Date</label>
                                          <md-datepicker ng-model="issue.due_date" md-placeholder="Due Date" style="color: white"></md-datepicker>
                                        </md-input-container>
                                      </div>
                                    </md-toolbar>
																	</md-card-content>
																</md-card>
															</div>
														</div>
                            <!-- END Messages -->
                        </div>
                        <div class="js-chat-form block-content block-content-full block-content-mini">
														<div id="my_summernote" data-js-summernote></div>
                        </div>
                    </div>
                    <!-- END Chat Window 5 -->
										<md-toolbar class="md-theme-light" style="justify-content: center">
                      <div class="col-xs-12" layout-gt-xs="row">
                        <div flex-gt-xs>
                          <md-input-container style="font-size: 15px; margin-bottom: 30px !important;" class="col-xs-12">
                            <label style="color: white">Assignee</label>
                            <md-select style="min-width: 200px;" ng-model="issue.assignee" ng-model-options="{trackBy: '$value._id'}" ng-change="selectFilter()" flex-gt-sm>
                              <md-option ng-value="none"><em>None</em></md-option>
                              <md-option ng-repeat="assignee in assignees | orderBy: 'full_name'" ng-value="assignee">
                                {{assignee.full_name}}
                              </md-option>
                            </md-select>
                          </md-input-container>
                        </div>

                        <div flex-gt-xs>
                          <md-input-container>
                            <label style="left: 0; color: white">Due Date</label>
                            <md-datepicker ng-model="issue.due_date" md-placeholder="Due Date" style="color: white"></md-datepicker>
                          </md-input-container>
                        </div>
                        <div flex-gt-xs>
                          <md-input-container class="col-xs-12 col-sm-4" style="padding: 0; float: right; margin-bottom: 30px !important;">
                            <md-button ng-click="comment()" style="margin-top: 0; margin: 0;" class="col-xs-12 md-raised">Comment</md-button>
                          </md-input-container>
                        </div>
                      </div>
										</md-toolbar>
                </div>
            </div>
            <!-- END Chat Fixed Height -->
        </div>
		</div>
	</div>
</div>
<div class="content">
    <div class="row">
        <div class="col-lg-8">
						<div ng-cloak id="popupContainer">
						</div>
				</div>
    </div>
</div>
<script>
$(document).ready(function() {
	function sendFile(file) {
    data = new FormData();
    data.append("file", file);
		console.log("data formatted", data);
    $.ajax({
        data: data,
        type: "POST",
        url: "/api/upload",
        cache: false,
        contentType: false,
        processData: false,
        success: function(response) {
						console.log('ajax success', response);
						var image = $('<img>').attr('src', response.url);
            $('#my_summernote').summernote("insertNode", image[0]);
        }
    });
	}
	$('#my_summernote').summernote({
		minHeight: 250,
		callbacks: {
			onImageUpload: function(files) {
				sendFile(files[0]);
				console.log('files -- image to upload: ', files);
			}
		}
	});
});
</script>
